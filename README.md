# üöÄ –°–µ—Ä–≤–∏—Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Avito Trainee 2023)

## –û–±–∑–æ—Ä –ü—Ä–æ–µ–∫—Ç–∞

https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-2023/Backend-trainee-assignment-2023.md

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π REST API –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π).

–ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∞—É–¥–∏—Ç–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –ø–æ–∑–≤–æ–ª—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞–º –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### üåü –ö–ª—é—á–µ–≤—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

  * **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ–≥–º–µ–Ω—Ç–∞–º–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É SLUG.
  * **–ì–∏–±–∫–æ–µ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∑–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é (`PATCH /user/{user_id}`).
  * **TTL (Time-To-Live):** –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (`ttl_hours`).
  * **–ò—Å—Ç–æ—Ä–∏—è –û–ø–µ—Ä–∞—Ü–∏–π:** –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –æ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —á–ª–µ–Ω—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü (`/segments/history?year=...&month=...`).
  * **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞ —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è.

-----

## üõ†Ô∏è –°—Ç–µ–∫ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **Go** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

  * **–Ø–∑—ã–∫:** Go (Golang)
  * **–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö:** **PostgreSQL** (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Å–≤—è–∑–µ–π –∏ –∏—Å—Ç–æ—Ä–∏–∏).
  * **–î—Ä–∞–π–≤–µ—Ä –ë–î:** `github.com/jackc/pgx/v5` (—á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞–∫–µ—Ç database/sql).
  * **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `log/slog`.
  * **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ —Ñ–∞–π–ª–∞ `.env` —á–µ—Ä–µ–∑ `github.com/joho/godotenv`.
  * **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** **Swagger** (OpenAPI) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `swaggo`.

-----

## üíª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CLI-–∫–ª–∏–µ–Ω—Ç

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API-—ç–Ω–¥–ø–æ–π–Ω—Ç–æ–≤ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —É—Ç–∏–ª–∏—Ç–∞ –≤ `cmd/client.go`. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–ª–∞–≥–∞: `--method`, `--endpoint` –∏ `--data`.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `go run ./cmd/client.go` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

  * **`--method`**: –£–∫–∞–∑—ã–≤–∞–µ—Ç HTTP-–º–µ—Ç–æ–¥ (`GET`, `POST`, `PATCH`, `DELETE`).
  * **`--endpoint`**: –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å API (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/`).
  * **`--data`**: JSON-payload –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ `POST` –∏ `PATCH` (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω).

-----

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π **Go** –∏ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π **PostgreSQL**.

### 1\. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –û–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª **`.env`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```ini
# .env
DATABASE_URL=postgres://avito_user:avito_password@localhost:5432/avito_segmentation_db?sslmode=disable
APP_PORT=8080
SHUTDOWN_TIMEOUT=15s
```

### 2\. –ó–∞–ø—É—Å–∫ –°–µ—Ä–≤–∏—Å–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
go mod download
go run ./cmd/main.go
```

  * **–°–µ—Ä–≤–∏—Å API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:** `http://localhost:8080`
  * **Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:** `http://localhost:8080/swagger/index.html`

-----

## üåê –ö–ª—é—á–µ–≤—ã–µ API –≠–Ω–¥–ø–æ–π–Ω—Ç—ã

### A. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ–≥–º–µ–Ω—Ç–∞–º–∏

  * **POST `/segments`**: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.
      * *Body:* `{"slug": "AVITO_NEW", "auto_percent": 10}` (auto\_percent –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω).
  * **GET `/segments`**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

### B. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–µ–≥–º–µ–Ω—Ç–∞–º–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

  * **GET `/user/{user_id}`**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –∫ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
  * **PATCH `/user/{user_id}`**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏/–∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤.
      * *Body:* `{"addslugs": ["AVITO_TEST"], "removeslugs": ["OLD_SEGMENT"], "ttl_hours": 72}`. –ü–æ–ª–µ `ttl_hours` (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ —á–∞—Å–∞—Ö) **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –¥–æ–±–∞–≤–ª—è–µ–º—ã–º —Å–µ–≥–º–µ–Ω—Ç–∞–º.

### C. –ò—Å—Ç–æ—Ä–∏—è –û–ø–µ—Ä–∞—Ü–∏–π

  * **GET `/segments/history`**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.
      * *Query Params:* `year` (int) –∏ `month` (int).

-----

## üíæ –°—Ö–µ–º–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

–ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞:

1.  **`segments`**: –•—Ä–∞–Ω–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ SLUG'–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `auto_percent`.
2.  **`user_segments`**: –¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–µ–π, —Ö—Ä–∞–Ω–∏—Ç `user_id`, `segment_id` –∏ –ø–æ–ª–µ **`expires_at`** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TTL.
3.  **`operation_history`**: –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞, —Ö—Ä–∞–Ω–∏—Ç `user_id`, `segment_slug`, `operation_type` (`ADDED`/`REMOVED`) –∏ `operation_time`.
